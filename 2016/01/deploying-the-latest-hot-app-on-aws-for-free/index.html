<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Deploying the Latest Hot App on AWS for Free*</title>
		<meta name="description" content="">
		<meta name="author" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href='//fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="http://esheavyindustries.com/b/css/normalize.css">
		<link rel="stylesheet" href="http://esheavyindustries.com/b/css/skeleton.css">
		<link rel="stylesheet" href="http://esheavyindustries.com/b/css/custom.css">
	</head>
	<body>
		<div class="container" style="background-color:#FFFFFF; border-bottom: 0px solid #eee;">
			<div class="row">
				<div class="seven columns">
					<a href="http://esheavyindustries.com/b" style="text-decoration: none; color: #333;"><span style="font-size: 36px; ">es<b>HeavyIndustries</b></span></a>
					<span style="font-size: 14px;">|<i>life, hobbies, work</i></span>
				</div>
				<div class="five columns">
					<div class="navbar-spacer"></div>
					<ul class="navbar-list" style="float:right">
						<li class="navbar-item"><a class="navbar-link" href="http://esheavyindustries.com/b//series/">about</a></li>
						<li class="navbar-item"><a class="navbar-link" href="http://github.com/esell" target="#">code</a></li>
						<li class="navbar-item"><a class="navbar-link" href="mailto:esell@esheavyindustries.com">contact</a></li>
					</ul>
				</div>
			</div>
		</div>
		<div class="container">
			
			<div class="row">
				<div class="twelve columns" >
					<img class="u-max-full-width" src="http://esheavyindustries.com/b/img/City-Under-Heat.jpg">
				</div>
			</div>
			



	<div class="row">
    	<div class="eight columns">
    		<a class="post-title-link" href="http://esheavyindustries.com/b/2016/01/deploying-the-latest-hot-app-on-aws-for-free/">Deploying the Latest Hot App on AWS for Free*</a>
    	</div>
    	
    	<div class="four columns" style="border-left: 3px solid #eee; background-color:white; color: black; padding-left: 8px; margin-top: 4px;">
    		<span style="font-size:small;">
    			categories:<br>
    			
				<a style="font-size:small; text-decoration: none;" href="http://esheavyindustries.com/b/categories/dev">dev</a>
    			
				<a style="font-size:small; text-decoration: none;" href="http://esheavyindustries.com/b/categories/go">Go</a>
    			
				<a style="font-size:small; text-decoration: none;" href="http://esheavyindustries.com/b/categories/aws">AWS</a>
    			
    		</span>
    	</div>
    	
    </div>
	<span class="post-postedby">posted by esells on Jan 01, 2016</span>
	<div class="row">
		<div class="twelve columns">
			

<h3 id="wait-what:028da4a231a5317af863941c3c91d223">Wait, what?</h3>

<p>AWS (Amazon Web Services) provides a free tier for new customers that allows you to play around with most of their services for a year without paying a cent. If you did not know that, you should head over to their page <a href="https://aws.amazon.com/free/">here</a> and take a look at the details.</p>

<p>This free tier is great for people who want to play around with the various AWS offerings without having to commit to anything. It is also a great way to deploy a new web app which is what I recently did and will cover in this post.</p>

<p>Understand that what I&rsquo;m talking about here is a bare-bones infrastructure that is good for low-volume, single region setups. This setup is NOT what you would typically use in your real production infrastructure but because of the way AWS is setup, you could easily scale out to a more fault tolerant architecture later without much work.</p>

<h3 id="free:028da4a231a5317af863941c3c91d223">&ldquo;Free&rdquo;</h3>

<p>Everything I talk about in this article was done using the free AWS tier except for the domain name. So when I say free I am not including the cost of purchasing a domain name but that is also technically not something you need in order to make this work.</p>

<p>Also I think it&rsquo;s worth mentioning again that this architecture works for your initial site or your proof-of-concept. Don&rsquo;t expect to run an app that is taking millions of hits a day on the free tier.</p>

<h3 id="background:028da4a231a5317af863941c3c91d223">Background</h3>

<p>I had a pet project of mine where the goal was to create an online wish list site that was basic, fast and just did what it was told. I wanted to create something that was super simple to use so that anyone in your family could use it. As this was a pet project I also didn&rsquo;t want to put in a lot of time supporting it or babysitting it. I wanted it to &ldquo;just work&rdquo; without me having to setup a metric ass ton of systems to support it.</p>

<p>The end result came out as <a href="https://thewishler.com">The Wishler</a>. Feel free to check it out, it&rsquo;s a live app and works as advertised so go nuts.</p>

<p>Many of the things I ended up doing are just basic AWS best practices.</p>

<h3 id="how-i-did-it:028da4a231a5317af863941c3c91d223">How I did it</h3>

<p><strong>NOTE:</strong> This is not meant to be a step-by-step tutorial but more of just a high-level overview on how one person stitched together various AWS offerings. The AWS documentation is pretty good so if you are new to AWS I&rsquo;d suggest checking those out.</p>

<p>I knew at the core what I wanted for The Wishler (an app server and a database) but the overall process was very iterative. I think this is one area where AWS really shines compared to other cloud providers. They have such a large catalog of offerings that you can basically hit a spot during your development where you think &ldquo;I could really use something that did _____&rdquo; and then jump onto their site and find a solution that matches up well.</p>

<p>So let&rsquo;s start at the beginning then: the app server. Since I was determined to stick to the free tier I decided to go with a standalone EC2 instance behind an Elastic Load Balancer. My actual app is a great candidate for Docker but with the way the EC2 Container service works you need to run your containers on EC2 instances. The only instance type that is free however is the t2.micro which I felt was not a great candidate for multiple containers.</p>

<p>Now that I knew what I was going to run my app on, I needed to come up with a way that would allow it to scale when the time comes. Since I didn&rsquo;t want to support additional load balancers and I really didn&rsquo;t want to come up with the glue to bring the process together I went with an off-the-shelf AWS Auto Scaling group and Elastic Load Balancer. The beauty in these (for me) is that if I outgrow the free tier for some reason I&rsquo;ll easily be able to scale pretty quickly. An example would be that my tiny t2.micro app server can no longer handle all the requests coming in. With an API call or a click of a button I can spin up a couple more t2.micro instances behind the already existing Elastic Load Balancer. No configuration changes, no IPs to keep track of just a simple way to handle growth.</p>

<p>In order to use Auto scaling groups you&rsquo;ll either need to create a base image that has something on it to install your app during start-up or use the user-data option. My app is written in Go and is pretty simple so I decided to lean some more on the free tier from AWS and use their CodeCommit product which is basically just a remote git repo. On start-up the instance will install the required Go tooling, checkout the master branch from CodeCommit, build it and start it up. There were quite a few options here that would have worked as well (creating a base AMI, keeping a deb file in S3, etc) but this gave me an excuse to play with another AWS product.</p>

<p>At this point I now had an ELB pointed at my ASG which meant users could reach the site&hellip; if they knew how to get to it. Using IPs to reach sites is not very popular these days so I decided to register a new domain <a href="https://thewishler.com">thewishler.com</a> and instead of using my registrars DNS tools use the AWS Route53 product. Route53 makes it super simple to plugin to existing AWS infrastructure and also supports some more advanced DNS level load balancing such as geo-location and latency. I should also point out that I did lie a bit and Route53 will cost you about $0.90 a month assuming you have one zone (domain) and keep under 1 million DNS queries. Once Route53 was setup I simply pointed my domain at my already existing ELB and ta-da!</p>

<p>Alright, so now I was at a point where I could serve up static pages so it was time to look at what I was going to use for the backend/database. I decided to go with Redis doing a rolling hourly snapshot to S3 which might seem kind of odd so let me explain. I am forward thinking so I wanted something that was going to easily scale not only across availability zones, but also across regions. When I say &ldquo;easily&rdquo; I mean something that from a maintenance and configuration standpoint is easy. I think for my specific application an RDBMS like MySQL or Postgres would have been a good fit but my experience with getting them to easily scale across regions has been more work than I wanted to put in.
Additionally the data I am dealing with is not what I consider critical data. If there is a complete failure and the database needs to be restored, missing an hour worth of data is not going to be the end of the world (in my opinion). On top of that Redis is fast which was a big factor for me.
Back on track&hellip; So Redis is my backend which meant that I could use the AWS ElastiCache offering. ElastiCache offers either Memcached or Redis for the engine type so it was a great fit for me. I can still develop against a local Redis instance and then deploy to AWS without having to change anything. Additionally ElastiCache is kind of like an ASG for Redis. If I need to I can increase the number of instances in the cluster, scale them out across availability zones, create replication groups, etc. All of this is done via a few button clicks or the API and I don&rsquo;t have to manage individual instances or installs which is really <strong>really</strong> nice.
With the goal of keeping things free I just went with a single cache.t2.micro instance and called it a day.</p>

<p>I was feeling pretty good now because I had the core of my app up and running in a somewhat robust setup in the sense that if an instance died off or failed it would be replaced with minimum downtime and it was all free*. I also didn&rsquo;t have to manage a damn thing and actually didn&rsquo;t even know the IP of any instance in my existing setup, all I cared about was pushing code to CodeCommit aka git and refreshing the ASG to pick-up the changes.</p>

<p>The code was coming along well until I hit a point where I realized I would have to occasionally send e-mails to people. As part of <a href="https://thewishler.com">The Wishler</a> password reset process the app sends out a unique reset ID via e-mail. Given that these e-mails are related to password resets I wanted them to hit the inbox and not get flagged as spam. I also did not want to manage an SMTP server. Guess what? AWS has an app for that called SES that allows you to send e-mails either via an API or plain ol SMTP using the AWS mail servers. This means another thing I don&rsquo;t have to manage AND the servers are on IPs that are not going to get flagged as spam. The setup was super simple and since I was already using Route53 all of the DKIM stuff was setup for me.</p>

<h3 id="and-then:028da4a231a5317af863941c3c91d223">And then&hellip;</h3>

<p>Now I&rsquo;m at a point where all of the app works and does what I want using the following products:</p>

<ul>
<li>EC2</li>
<li>ElastiCache</li>
<li>Route53</li>
<li>CodeCommit</li>
<li>SES</li>
</ul>

<p>and am already re-thinking some things that could change or that could be re-done. One thing I&rsquo;ve been toying around with was using the Lambda service to get rid of servers but since the app is already written in Go I would need to re-write everything. I&rsquo;d also like to wrap in the CodeDeploy and CodePipeline services since I only have a single app and would be able to stay on the free tier.</p>

<h3 id="so-when-aws-goes-under:028da4a231a5317af863941c3c91d223">So when AWS goes under</h3>

<p>One of the biggest risks with this is that even though I haven&rsquo;t put any AWS specific API calls or anything into my code, if AWS was going to close at the end of the month I would have some problems. The biggest of course would be replicating the services on my own hardware or VMs. It&rsquo;s easy enough to just setup a basic SMTP box or HAProxy load balancer, the complications come into play when you start talking about multiple availability zones and regions. Keeping things simple while allowing yourself to scale with a push of a button is something that AWS does a really good job of and that is not easy to replicate. My personal belief is to develop your application(s) to use non-vendor specific APIs or whatever so that you can easily move it if needed, but until that point comes leverage the offerings your vendor has and spend the time you&rsquo;re saving to improve your application.</p>

		</div>
	</div>
	
	<div class="row">
        <div class="twelve columns">
            &nbsp;
        </div>
    </div>

    <div id="footer" class="row">
    	<div class="twelve columns">
			<center>
			<span style="font-size: small;">
				[ theme created by <a href="http://github.com/esell" style="text-decoration: none;" target="#">esell</a> ]
			</span>
			</center>
		</div>
    </div>
</div>

</body>
</html>


